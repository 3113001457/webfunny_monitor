!function(e){var t={};function r(a){if(t[a])return t[a].exports;var n=t[a]={i:a,l:!1,exports:{}};return e[a].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,a){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(r.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(a,n,function(t){return e[t]}.bind(null,n));return a},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){let r=wx;var a,n;n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",(a=r).btoa=a.btoa||function(e){for(var t,r,a,o,i="",s=0,c=(e=String(e)).length%3;s<e.length;){if((r=e.charCodeAt(s++))>255||(a=e.charCodeAt(s++))>255||(o=e.charCodeAt(s++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");i+=n.charAt((t=r<<16|a<<8|o)>>18&63)+n.charAt(t>>12&63)+n.charAt(t>>6&63)+n.charAt(63&t)}return c?i.slice(0,c-3)+"===".substring(c):i};var o=r.getStorageSync("WF_CONFIG"),i=o||{s:!0,ia:[""],wc:40,pv:{s:"webfunny-pageview-switch",ia:[""]},je:{s:"webfunny-jserror-switch",ia:[""]},hl:{s:"webfunny-http-switch",ia:[""],uh:!1,rl:500,sl:500},rl:{s:"webfunny-resource-switch",ia:[""]},bl:{s:"webfunny-behavior-switch"},lc:{s:"webfunny-location-switch"}},s="jeffery_webmonitor",c="webfunnyVersionFlag",u="&&&www.webfunny.cn&&&",l="http://"+u,f=l+"/server/upMog",g="CUSTOMER_PV",h="CUS_LEAVE",d="HTTP_LOG",p="JS_ERROR",v="LAST_BROWSE_DATE",y="WM_PAGE_ENTRY_TIME",m="WM_VISIT_PAGE_COUNT",w="WEBFUNNY_COOKIE",T=[p,g,d],b=function(e){var t=new x("reload",0,"o","");t.simpleUrl=e,t.completeUrl=e,t.handleLogInfo(g,t)};class S{static getCurrentPages(){var e="";try{e=getCurrentPages().length?getCurrentPages()[0].route:""}catch(t){e=""}return e}static getUuid(){var e=S.formatDate((new Date).getTime(),"yMdhms");return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})+"-"+e}static getCustomerKey(){var e=S.getUuid(),t=r.getStorageSync("monitorCustomerKey");return t||(r.setStorage({key:"monitorCustomerKey",data:e}),t=e),t}static isTodayBrowse(e){var t=r.getStorageSync(e),a=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();return t&&a==t?!(!t||a!=t):(r.setStorageSync(e,a),!1)}static formatDate(e,t){var r=new Date(e).getFullYear(),a=new Date(e).getMonth()+1,n=new Date(e).getDate(),o=new Date(e).getHours(),i=new Date(e).getMinutes(),s=new Date(e).getSeconds();return a=a>9?a:"0"+a,n=n>9?n:"0"+n,o=o>9?o:"0"+o,i=i>9?i:"0"+i,s=s>9?s:"0"+s,t.replace("y",r).replace("M",a).replace("d",n).replace("h",o).replace("m",i).replace("s",s)}static getPageKey(){var e=r.getStorageSync("monitorPageKey"),t=S.getUuid();return e&&/^[0-9a-z]{8}(-[0-9a-z]{4}){3}-[0-9a-z]{12}-\d{13}$/.test(e)||(e=t),e}static setPageKey(){r.setStorage({key:"monitorPageKey",data:S.getUuid()})}static ajax(e,t,a,n,o){r.request({method:e,url:t,data:a,header:{"Content-Type":"application/json"},success:e=>{"function"==typeof n&&n(e)},fail:e=>{"function"==typeof o&&o(e)}})}static uploadCusBehavior(e,t,a){var n=r.getStorageSync("wmUserInfo"),o=n?JSON.parse(n):{},i={webMonitorId:s,userId:o.userId,uploadType:"CUSTOMIZE_BEHAVIOR",happenTime:(new Date).getTime(),behaviorType:S.b64EncodeUnicode(e),behaviorResult:S.b64EncodeUnicode(t),description:S.b64EncodeUnicode(a)};r.request({method:"POST",url:l+"/server/upMyLog",data:{logs:[i]},header:{"Content-Type":"application/json"}})}static checkReqResLen(e="",t="",r){var a=e?JSON.stringify(e):"no param",n=t?JSON.stringify(t):"no result",o=parseInt(r.rl)||500,i=parseInt(r.sl)||500;return a&&a.length>o&&(a="too long"),n&&n.length>i&&(n="too long"),{requestText:a,responseText:n}}static encryptObj(e){if(e instanceof Array){for(var t=[],r=0;r<e.length;++r)t[r]=S.encryptObj(e[r]);return t}if(e instanceof Object){t={};for(var r in e)t[r]=S.encryptObj(e[r]);return t}return(e+="").length>50&&(e=e.substring(0,10)+"****"+e.substring(e.length-9,e.length)),e}static getDevice(){return r.getSystemInfoSync()}static b64EncodeUnicode(e){var t=encodeURIComponent(e);try{return r.btoa(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))}catch(e){return t}}static utf8_encode(e){if(!e)return"";var t="";e=e.replace(/\r\n/g,"\n");for(var r=0;r<e.length;r++){var a=e.charCodeAt(r);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t}static setWfCookie(e,t,a){var n={data:t,expires:a},o=r.getStorageSync(w);if(o)o[e]=n,r.setStorage(w,o);else{var i={};i[e]=n,r.setStorage(w,i)}}static getWfCookie(e){var t=r.getStorageSync(w);if(t){var a=t[e];if(!a)return"";var n=parseInt(a.expires,10);return(new Date).getTime()>n?(delete t[e],r.setStorage(w,t),""):a.data}return""}static checkIgnore(e,t){if(!t)return!0;for(var r=t.replace(/ /g,""),a=i[e].ia||[],n=!0,o=0;o<a.length;o++){var s=a[o].replace(/ /g,"");if(s&&-1!=r.indexOf(s)){n=!1;break}}return n}}class C{constructor(){var e=r.getStorageSync("wmUserInfo"),t=e?JSON.parse(e):{},a=S.getCurrentPages();this.wmVersion=c,this.happenTime=(new Date).getTime(),this.webMonitorId=s,this.simpleUrl=a,this.completeUrl=a,this.customerKey=S.getCustomerKey(),this.userId=t.userId,this.projectVersion=t.projectVersion||"",this.firstUserParam=S.b64EncodeUnicode(t.userTag||""),this.secondUserParam=S.b64EncodeUnicode(t.secondUserParam||"")}handleLogInfo(e,t){var a=r.getStorageSync(e),n=a||[];n.push(t),r.setStorageSync(e,n)}}class x extends C{constructor(e,t,r,a){super();var n=S.getDevice();this.uploadType=g,this.pageKey=S.getPageKey(),this.deviceName=n.model,this.os=n.system,this.browserName=n.platform,this.browserVersion=n.version,this.deviceSize=n.screenWidth+"×"+n.screenHeight,this.monitorIp="",this.country="",this.province="",this.city="",this.loadType=e,this.loadTime=t,this.newStatus=r,this.referrer=(a||"").split("?")[0].replace("#","")}}class O{constructor(e){var t=S.getCurrentPages();this.uploadType=h,this.webMonitorId=s,this.leaveType=e,this.happenTime=(new Date).getTime(),this.simpleUrl=t,this.customerKey=S.getCustomerKey()}}class P extends C{constructor(e,t,r,a,n){super();var o=S.getDevice();this.uploadType=e,this.infoType=t,this.pageKey=S.getPageKey(),this.deviceName=o.model,this.os=o.system,this.browserName=o.platform,this.browserVersion=o.version,this.monitorIp="",this.country="china",this.province="",this.city="",this.simpleErrorMessage=S.b64EncodeUnicode(r),this.errorMessage=S.b64EncodeUnicode(a),this.errorStack=S.b64EncodeUnicode(n),this.browserInfo=""}}class I extends C{constructor(e,t,r,a,n,o,i,s,c){super(),this.uploadType=e,this.method=t?t.toLowerCase():"get",this.httpUrl=S.b64EncodeUnicode(r),this.status=a,this.statusText=n,this.statusResult=o,this.requestText=S.b64EncodeUnicode(i),this.responseText=S.b64EncodeUnicode(s),this.loadTime=c}}var D="";function U(){if(getCurrentPages().length){var e=S.getCurrentPages();D!=e&&(!function(){var e=S.getCurrentPages();if(e){var t=S.isTodayBrowse(v),a=(new Date).getTime();r.setStorageSync(y,a);var n=null,o=S.formatDate(a,"y-M-d"),i=e,s=r.getStorageSync(m);if(s){var c=s.split("$$$"),u=c[0],l=c[1],h=parseInt(c[2],10);o==l?i!=u&&1==h&&(r.setStorageSync(m,i+"$$$"+o+"$$$2"),n=new O(2)):(r.setStorageSync(m,i+"$$$"+o+"$$$1"),n=new O(1))}else r.setStorageSync(m,i+"$$$"+o+"$$$1"),n=new O(1);var d=r.getStorageSync("monitorCustomerKey");if(d){var p="",w=d?d.match(/\d{14}/g):[];if(w&&w.length>0){var T=w[0].match(/\d{2}/g),b=T[0]+T[1]+"-"+T[2]+"-"+T[3]+" "+T[4]+":"+T[5]+":"+T[6],C=new Date(b).getTime();p=(new Date).getTime()-C>300?0==t?"o_uv":"o":"n_uv"}}else p="n_uv",S.getCustomerKey();var P=new x("reload",0,p,"");if("n_uv"===p||"o_uv"===p){var I=[P,n];S.ajax("POST",f,I)}else P.handleLogInfo(g,P)}}(),D=e)}}function _(e,t,r,a,n,o){U();var i=t||"",s=o||"",c="",u="";(i.length>=1e3&&(i=i.substring(0,999)),s.length>=3e3&&(s=s.substring(0,2999)),i.length>=80?u=i.substring(0,80):i.length>0&&i.length<80&&(u=i),i)&&(c="string"==typeof s?s.split(": ")[0].replace('"',""):JSON.stringify(s).split(": ")[0].replace('"',""));if(S.checkIgnore("je",i)){var l=new P(p,e,c+": "+u,c+": "+i,s);l.handleLogInfo(p,l)}}function B(){for(var e=[],t=0;t<T.length;t++){var a=r.getStorageSync(T[t]);e=e.concat(a)}for(var n=0;n<T.length;n++)r.setStorageSync(T[n],[]);e.length>0&&S.ajax("POST",f,e,function(e){if(e&&e.data){var t=e.data;if(t&&t.data&&t.data.d){var a=t.data.c;if(a){var n=JSON.parse(a);if(r.setStorage({key:"WF_CONFIG",data:n}),i=n,0==n.s){var o=(new Date).getTime()+6e5;S.setWfCookie("webfunnyStart","p",o)}}}}},function(){})}wx.webfunny=function(e){for(var t=i.ia,a=!1,n=S.getCurrentPages(),o=0;o<t.length;o++){var s=t[o].replace(/ /g,"");if(s&&-1!=n.indexOf(s)){a=!0;break}}var c=S.getWfCookie("webfunnyStart")||i.s;if(c&&"p"!=c&&!a){var l,h=i.wc||40,p=i.je,y=i.hl,m=wx;wx=Object.create(wx),Object.defineProperty(wx,"switchTab",{writable:!1,value:function(e){var t=arguments[0].success,r=arguments[0].fail,a=arguments[0].complete;if(!(t||r||a))return new Promise((t,r)=>{arguments[0].success=function(...r){S.uploadCusBehavior("switchTab","success","Tab切换至："+e.url),t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("switchTab","failed","Tab切换至："+e.url),r(...t)},m.switchTab.apply(this,arguments)});arguments[0].success=function(...r){S.uploadCusBehavior("switchTab","success","Tab切换至："+e.url),t&&t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("switchTab","failed","Tab切换至："+e.url),r&&r(...t)},m.switchTab.apply(this,arguments)}}),Object.defineProperty(wx,"navigateBack",{writable:!1,value:function(e){var t=arguments[0].success,r=arguments[0].fail,a=arguments[0].complete;if(!(t||r||a))return new Promise((t,r)=>{arguments[0].success=function(...r){S.uploadCusBehavior("navigateBack","success","页面回层数："+e.delta),t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("navigateBack","failed","页面回层数："+e.delta),r(...t)},m.navigateBack.apply(this,arguments)});arguments[0].success=function(...r){S.uploadCusBehavior("navigateBack","success","页面回层数："+e.delta),t&&t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("navigateBack","failed","页面回层数："+e.delta),r&&r(...t)},m.navigateBack.apply(this,arguments)}}),Object.defineProperty(wx,"navigateTo",{writable:!1,value:function(e){var t=arguments[0].success,r=arguments[0].fail,a=arguments[0].complete;if(!(t||r||a))return new Promise((t,r)=>{arguments[0].success=function(...r){S.uploadCusBehavior("navigateTo","success","页面切换至："+e.url),b(e.url),t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("navigateTo","failed","页面切换至："+e.url),r(...t)},m.navigateTo.apply(this,arguments)});arguments[0].success=function(...r){S.uploadCusBehavior("navigateTo","success","页面切换至："+e.url),b(e.url),t&&t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("navigateTo","failed","页面切换至："+e.url),r&&r(...t)},m.navigateTo.apply(this,arguments)}}),Object.defineProperty(wx,"redirectTo",{writable:!1,value:function(e){var t=arguments[0].success,r=arguments[0].fail,a=arguments[0].complete;if(!(t||r||a))return new Promise((t,r)=>{arguments[0].success=function(...r){S.uploadCusBehavior("redirectTo","success","重定向："+e.url),t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("redirectTo","failed","重定向："+e.url),r(...t)},m.redirectTo.apply(this,arguments)});arguments[0].success=function(...r){S.uploadCusBehavior("redirectTo","success","重定向："+e.url),t&&t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("redirectTo","failed","重定向："+e.url),r&&r(...t)},m.redirectTo.apply(this,arguments)}}),Object.defineProperty(wx,"reLaunch",{writable:!1,value:function(e){var t=arguments[0].success,r=arguments[0].fail,a=arguments[0].complete;if(!(t||r||a))return new Promise((t,r)=>{arguments[0].success=function(...r){S.uploadCusBehavior("reLaunch","success","重启："+e.url),t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("reLaunch","failed","重启："+e.url),r(...t)},m.reLaunch.apply(this,arguments)});arguments[0].success=function(...r){S.uploadCusBehavior("reLaunch","success","重启："+e.url),t&&t(...r)},arguments[0].fail=function(...t){S.uploadCusBehavior("reLaunch","failed","重启："+e.url),r&&r(...t)},m.reLaunch.apply(this,arguments)}}),Object.defineProperty(wx,"request",{writable:!1,value:function(e){function t(e,t,r,a,n,o,i,s,c){if(S.checkIgnore("hl",r)){var u=new I(e,t,r,a,n,o,i,s,c);u.handleLogInfo(e,u)}}if(-1==e.url.indexOf(u)){e.startTime=(new Date).getTime();var r=e.method,a=e.url;t(d,r,a,"200","OK","request","","",0)}var n=arguments[0].success,o=arguments[0].fail,i=arguments[0].complete;if(!(n||o||i))return new Promise((r,a)=>{arguments[0].success=function(...a){if(-1==e.url.indexOf(u)){var n=(new Date).getTime()-e.startTime,o=e.method,i=e.url,s=a[0],c=s.statusCode,l=S.checkReqResLen(e.data,s.data,y);t(d,o,i,c,"OK","response",l.requestText,l.responseText,n)}r(...a)},arguments[0].fail=function(...r){if(-1==e.url.indexOf(u)){var n=(new Date).getTime()-e.startTime,o=e.method,i=e.url,s=r[0],c=JSON.stringify(e.data),l=s.errMsg;t(d,o,i,555,"fail","response",c,l,n)}a(...r)},m.request.apply(this,arguments)});arguments[0].success=function(...r){if(-1==e.url.indexOf(u)){var a=(new Date).getTime()-e.startTime,o=e.method,i=e.url,s=r[0],c=s.statusCode,l=S.checkReqResLen(e.data,s.data,y);t(d,o,i,c,"OK","response",l.requestText,l.responseText,a)}n&&n(...r)},arguments[0].fail=function(...r){if(-1==e.url.indexOf(u)){var a=(new Date).getTime()-e.startTime,n=e.method,i=e.url,s=r[0],c=JSON.stringify(e.data),l=s.errMsg;t(d,n,i,555,"fail","response",c,l,a)}o&&o(...r)},m.request.apply(this,arguments)}}),p.s&&(l=console.error,console.error=function(e){var t=arguments[0]&&arguments[0].message||e,r=arguments[0]&&arguments[0].stack;if(r)_("on_error",t,0,0,0,r);else{if("object"==typeof t)try{t=JSON.stringify(t)}catch(e){t="错误无法解析"}_("console_error",t,0,0,0,"CustomizeError: "+t)}return l.apply(console,arguments)});var w=(new Date).getTime();setInterval(function(){U();let e=(new Date).getTime(),t=e-w;r.getStorageSync(d).length>10?B():t>=200*h&&(B(),w=e)},1e3);var T={onLaunch:function(){!function(e){var t=S.isTodayBrowse(v),a=r.getStorageSync("monitorCustomerKey");if(a){var n="",o=a?a.match(/\d{14}/g):[];if(o&&o.length>0){var i=o[0].match(/\d{2}/g),s=i[0]+i[1]+"-"+i[2]+"-"+i[3]+" "+i[4]+":"+i[5]+":"+i[6],c=new Date(s).getTime();n=(new Date).getTime()-c>300?0==t?"o_uv":"o":"n_uv"}}else n="n_uv",S.getCustomerKey();var u=new x("reload",0,n,"");if(u.simpleUrl=e,u.completeUrl=e,"n_uv"===n||"o_uv"===n){var l=[u];S.ajax("POST",f,l)}else u.handleLogInfo(g,u)}("onLaunch")},onError:function(e){if(p.s){var t="";"string"==typeof e?t=e:"object"==typeof e&&(t=e.stack||"");var r=t.split("\n")[2];S.getCurrentPages(),_("on_error",r,0,0,0,t)}}};for(const t in T){const r="function"==typeof e[t]&&e[t];e[t]=function(){T[t].apply(this,arguments),r&&r.apply(this,arguments)}}return e}}}]);