!function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}([function(e,t){var r="jeffery_webmonitor",n="webfunnyVersionFlag",o="&&&www.webfunny.cn&&&",a="http://"+o,s=a+"/server/upMog",i="CUSTOMER_PV",c="CUS_LEAVE",u="HTTP_LOG",g="JS_ERROR",h="LAST_BROWSE_DATE",l="WM_PAGE_ENTRY_TIME",d="WM_VISIT_PAGE_COUNT",f=[g,i,u];class p{static getUuid(){var e=p.formatDate((new Date).getTime(),"yMdhms");return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})+"-"+e}static getCustomerKey(){var e=p.getUuid(),t=wx.getStorageSync("monitorCustomerKey");return t||(wx.setStorage({key:"monitorCustomerKey",data:e}),t=e),t}static isTodayBrowse(e){var t=wx.getStorageSync(e),r=(new Date).getFullYear()+"-"+((new Date).getMonth()+1)+"-"+(new Date).getDate();return t&&r==t?!(!t||r!=t):(wx.setStorageSync(e,r),!1)}static formatDate(e,t){var r=new Date(e).getFullYear(),n=new Date(e).getMonth()+1,o=new Date(e).getDate(),a=new Date(e).getHours(),s=new Date(e).getMinutes(),i=new Date(e).getSeconds();return n=n>9?n:"0"+n,o=o>9?o:"0"+o,a=a>9?a:"0"+a,s=s>9?s:"0"+s,i=i>9?i:"0"+i,t.replace("y",r).replace("M",n).replace("d",o).replace("h",a).replace("m",s).replace("s",i)}static getPageKey(){var e=wx.getStorageSync("monitorPageKey"),t=p.getUuid();return e&&/^[0-9a-z]{8}(-[0-9a-z]{4}){3}-[0-9a-z]{12}-\d{13}$/.test(e)||(e=t),e}static setPageKey(){wx.setStorage({key:"monitorPageKey",data:p.getUuid()})}static ajax(e,t,r,n,o){wx.request({method:e,url:t,data:r,header:{"Content-Type":"application/json"},success:e=>{"function"==typeof n&&n(e)},fail:e=>{"function"==typeof o&&o(e)}})}static encryptObj(e){if(e instanceof Array){for(var t=[],r=0;r<e.length;++r)t[r]=p.encryptObj(e[r]);return t}if(e instanceof Object){t={};for(var r in e)t[r]=p.encryptObj(e[r]);return t}return(e+="").length>50&&(e=e.substring(0,10)+"****"+e.substring(e.length-9,e.length)),e}static getDevice(){return wx.getSystemInfoSync()}static b64EncodeUnicode(e){var t,r,n,o,a,s,i,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",u=e,g="",h=0;for(u=p.utf8_encode(u);h<u.length;)o=(t=u.charCodeAt(h++))>>2,a=(3&t)<<4|(r=u.charCodeAt(h++))>>4,s=(15&r)<<2|(n=u.charCodeAt(h++))>>6,i=63&n,isNaN(r)?s=i=64:isNaN(n)&&(i=64),g=g+c.charAt(o)+c.charAt(a)+c.charAt(s)+c.charAt(i);return g}static utf8_encode(e){if(!e)return"";var t="";e=e.replace(/\r\n/g,"\n");for(var r=0;r<e.length;r++){var n=e.charCodeAt(r);n<128?t+=String.fromCharCode(n):n>127&&n<2048?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t}}class y{constructor(){var e=wx.getStorageSync("wmUserInfo"),t=e?JSON.parse(e):{},o=getCurrentPages().length?getCurrentPages()[0].route:"App Launched";this.wmVersion=n,this.happenTime=(new Date).getTime(),this.webMonitorId=r,this.simpleUrl=o,this.completeUrl=o,this.customerKey=p.getCustomerKey(),this.userId=t.userId,this.projectVersion=t.projectVersion||"",this.firstUserParam=p.b64EncodeUnicode(encodeURIComponent(t.userTag||"")),this.secondUserParam=p.b64EncodeUnicode(t.secondUserParam||"")}handleLogInfo(e,t){var r=wx.getStorageSync(e),n=r||[];n.push(t),wx.setStorageSync(e,n)}}class m extends y{constructor(e,t,r,n){super();var o=p.getDevice();this.uploadType=i,this.pageKey=p.getPageKey(),this.deviceName=o.model,this.os=o.system,this.browserName=o.platform,this.browserVersion=o.version,this.monitorIp="",this.country="",this.province="",this.city="",this.loadType=e,this.loadTime=t,this.newStatus=r,this.referrer=(n||"").split("?")[0].replace("#","")}}class x{constructor(e){var t=getCurrentPages().length?getCurrentPages()[0].route:"App Launched";this.uploadType=c,this.webMonitorId=r,this.leaveType=e,this.happenTime=(new Date).getTime(),this.simpleUrl=t,this.customerKey=p.getCustomerKey()}}class w extends y{constructor(e,t,r,n){super();var o=p.getDevice();this.uploadType=e,this.infoType=t,this.pageKey=p.getPageKey(),this.deviceName=o.model,this.os=o.system,this.browserName=o.platform,this.browserVersion=o.version,this.monitorIp="",this.country="china",this.province="",this.city="",this.errorMessage=p.b64EncodeUnicode(r),this.errorStack=p.b64EncodeUnicode(n),this.browserInfo=""}}class v extends y{constructor(e,t,r,n,o,a,s,i,c){super(),this.uploadType=e,this.method=t,this.httpUrl=p.b64EncodeUnicode(encodeURIComponent(r)),this.status=n,this.statusText=o,this.statusResult=a,this.requestText=p.b64EncodeUnicode(s),this.responseText=p.b64EncodeUnicode(i),this.loadTime=c}}var S="";function T(){var e=p.isTodayBrowse(h),t=(new Date).getTime();wx.setStorageSync(l,t);var r=getCurrentPages().length?getCurrentPages()[0].route:"App Launched",n=null,o=p.formatDate(t,"y-M-d"),a=encodeURIComponent(r),c=wx.getStorageSync(d);if(c){var u=c.split("$$$"),g=u[0],f=u[1],y=parseInt(u[2],10);o==f?a!=g&&1==y&&(wx.setStorageSync(d,a+"$$$"+o+"$$$2"),n=new x(2)):(wx.setStorageSync(d,a+"$$$"+o+"$$$1"),n=new x(1))}else wx.setStorageSync(d,a+"$$$"+o+"$$$1"),n=new x(1);var w=wx.getStorageSync("monitorCustomerKey");if(w){var v="",S=w?w.match(/\d{14}/g):[];if(S&&S.length>0){var T=S[0].match(/\d{2}/g),b=T[0]+T[1]+"-"+T[2]+"-"+T[3]+" "+T[4]+":"+T[5]+":"+T[6],C=new Date(b).getTime();v=(new Date).getTime()-C>300?0==e?"o_uv":"o":"n_uv"}}else v="n_uv",p.getCustomerKey();var P=new m("reload",0,v,"");if("n_uv"===v||"o_uv"===v){var O=[P,n];p.ajax("POST",s,O)}else P.handleLogInfo(i,P)}function b(){if(getCurrentPages().length){var e=getCurrentPages()[0].route;S!=e&&(T(),S=e)}}wx.webfunny=function(e){var t,r=0;setInterval(function(){if(b(),r>=40){for(var e=[],t=0;t<f.length;t++){var n=wx.getStorageSync(f[t]);e=e.concat(n)}for(var o=0;o<f.length;o++)wx.setStorageSync(f[o],[]);e.length>0&&p.ajax("POST",s,e,function(){},function(){}),r=0}r++},200),t=wx,wx=Object.create(wx),Object.defineProperty(wx,"request",{writable:!1,value:function(e){if(-1==e.url.indexOf(o)){e.startTime=(new Date).getTime();var r=e.method,n=e.url,a=new v(u,r,n,"200","OK","发起请求","","",0);a.handleLogInfo(u,a)}var s=arguments[0].success,i=arguments[0].fail;arguments[0].success=function(...t){if(-1==e.url.indexOf(o)){var r=(new Date).getTime()-e.startTime,n=e.method,a=e.url,i=t[0],c=i.statusCode,g=JSON.stringify(e.data),h=JSON.stringify(i.data),l=parseInt("&&&responseTextLength&&&")||500;h&&h.length>l&&(h="内容太长");var d=new v(u,n,a,c,"OK","请求返回",g,h,r);d.handleLogInfo(u,d)}s(...t)},arguments[0].fail=function(...t){if(-1==e.url.indexOf(o)){var r=(new Date).getTime()-e.startTime,n=e.method,a=e.url,s=t[0],c=JSON.stringify(e.data),g=s.errMsg,h=new v(u,n,a,555,"fail","请求返回",c,g,r);h.handleLogInfo(u,h)}i(...t)},t.request.apply(this,arguments)}});var n={onLaunch:function(){T()},onError:function(e){var t=e.split("\n")[2];getCurrentPages().length&&getCurrentPages()[0].route,function(e,t,r,n,o,a){b();var s=new w(g,e,t||"",a||"");s.handleLogInfo(g,s)}("on_error",t,0,0,0,e)}};for(const t in n){const r="function"==typeof e[t]&&e[t];e[t]=function(){n[t].apply(this,arguments),r&&r.apply(this,arguments)}}return e}}]);